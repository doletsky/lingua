import{_ as $,u as N,a as P,c as j,b as q,r as S,o as F,d as a,e as c,f as k,t as l,F as V,g as D,h as E,i as r}from"./index-CH5VPy14.js";const H={class:"unit-sprints"},L={class:"unit-header"},O={key:0},z={key:0,class:"loading"},J={key:1,class:"empty"},K={key:2,class:"sprints-grid"},Q={class:"card-header"},T={class:"grammar-title"},W={class:"meta"},X={key:0},Y={key:1},Z={key:0,class:"grammar-desc"},tt={class:"card-actions"},et=["onClick"],st=["onClick"],at={__name:"UnitSprints",setup(rt){const C=q(),b=E(),_=N(),v=P(),h=j(()=>{const t=C.params.unitId;if(t&&typeof t=="string")return t;const e=v.currentUnit;return typeof e=="string"?e:e&&e.value?e.value:String(e)}),I=S(!0),y=S([]),w=S(null),d=S({});F(async()=>{I.value=!0;try{await _.loadAll();const t=h.value;let e=[];try{const n=_.getGrammarByUnit;n&&typeof n.value=="function"?e=n.value(t)||[]:e=(_.grammar||[]).filter(m=>m.unit===t)}catch(n){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸Ğº Ñ‡ĞµÑ€ĞµĞ· getter:",n),e=(_.grammar||[]).filter(m=>m.unit===t)}y.value=e,w.value={name:`Ğ®Ğ½Ğ¸Ñ‚ ${String(t).replace("unit","")}`};const s=await v.getSprintHistoryByUnit(t),f={};for(const n of y.value){const m=s.filter(i=>i.exerciseResults&&i.exerciseResults.some(o=>o.snapshot&&o.snapshot.grammarId===n.id)),g=new Map;for(const i of m){const x=`${(i.exerciseResults||[]).map(p=>{const u=p.snapshot||{};return Array.isArray(u.itemIds)&&u.itemIds.length>0?u.itemIds.join(","):u.itemId!==void 0&&u.itemId!==null?String(u.itemId):p.itemId!==void 0&&p.itemId!==null?String(p.itemId):String(p.exerciseId||"")}).filter(Boolean).sort().join("|")}::${n.id}`;g.has(x)||g.set(x,[]),g.get(x).push(i)}const B=Array.from(g.values()),M=B.length,U=B.map(i=>Math.max(...i.map(o=>o.stats&&typeof o.stats.accuracy=="number"?o.stats.accuracy:0))),R=U.length>0?Math.round(U.reduce((i,o)=>i+o,0)/U.length):null;f[n.id]={timesPracticed:M,lastAccuracy:R}}d.value=f}catch(t){console.error("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚Ğ¾Ğ² ÑĞ½Ğ¸Ñ‚Ğ°:",t)}finally{I.value=!1}});const A=async t=>{await v.setCurrentUnit(h.value);try{await b.push({name:"Sprint",query:{grammarId:t}})}catch(e){console.error("[UnitSprints] Navigation error:",e)}},G=async t=>{try{await v.setCurrentUnit(h.value),await b.push({name:"Sprint",query:{grammarId:t,viewOnly:!0}})}catch(e){console.error("[UnitSprints] Navigation error on viewGrammar:",e)}};return(t,e)=>(r(),a("div",H,[c("header",L,[c("h2",null,"ğŸ“š Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚Ñ‹ â€” "+l(h.value),1),w.value?(r(),a("p",O,l(w.value.name),1)):k("",!0)]),I.value?(r(),a("div",z,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...")):y.value.length===0?(r(),a("div",J,"Ğ“Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞ½Ğ¸Ñ‚Ğ°")):(r(),a("div",K,[(r(!0),a(V,null,D(y.value,s=>(r(),a("div",{key:s.id,class:"grammar-card"},[c("div",Q,[c("h3",T,l(s.title),1),c("div",W,[d.value[s.id]?(r(),a("span",X,"â±ï¸ "+l(d.value[s.id].timesPracticed)+"Ã—",1)):k("",!0),d.value[s.id]?(r(),a("span",Y,"ğŸ“Š "+l(d.value[s.id].lastAccuracy||"â€”")+"%",1)):k("",!0)])]),s.excerpt?(r(),a("p",Z,l(s.excerpt),1)):k("",!0),c("div",tt,[c("button",{onClick:f=>A(s.id),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,et),c("button",{onClick:f=>G(s.id),class:"btn-view"},"ğŸ‘€ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€",8,st)])]))),128))]))]))}},ot=$(at,[["__scopeId","data-v-1b578c46"]]);export{ot as default};
