import{_ as W,u as X,a as Y,c as Z,b as tt,r as _,o as et,d as o,e as r,f as v,t as d,F as G,g as q,h as st,i,j as at}from"./index-Cg42h42M.js";const nt={class:"unit-sprints"},rt={class:"unit-header"},ot={key:0},it={key:0,class:"loading"},ct={key:1,class:"empty"},lt={key:2},ut={key:0,class:"sprints-grid"},dt={class:"card-header"},pt={class:"grammar-title"},vt={class:"meta"},ht={key:0},gt={key:1},mt={key:0,class:"grammar-desc"},yt={class:"card-actions"},_t=["onClick"],ft=["onClick"],xt={key:1,class:"texts-section"},St={class:"sprints-grid"},kt={class:"card-header"},wt={class:"grammar-title"},bt={key:0},It={class:"meta"},Ct={key:0},Ut={key:1},At={class:"card-actions"},Bt=["onClick"],Mt={key:2,class:"texts-section"},Tt={class:"sprints-grid"},$t={class:"card-header"},Rt={class:"grammar-title"},Pt={class:"meta"},Nt={key:0},Vt={key:1},Gt={key:0,class:"grammar-desc"},qt={class:"card-actions"},jt=["onClick"],Ft=["onClick"],Lt={__name:"UnitSprints",setup(Ot){const D=tt(),b=st(),h=X(),x=Y(),S=Z(()=>{const a=D.params.unitId;if(a&&typeof a=="string")return a;const n=x.currentUnit;return typeof n=="string"?n:n&&n.value?n.value:String(n)}),T=_(!0),I=_([]),$=_([]),C=_([]),R=_(null),U=_({}),A=_({}),B=_({}),P=_([]);et(async()=>{T.value=!0;try{await h.loadAll();const a=S.value;let n=[];try{const e=h.getGrammarByUnit;e&&typeof e.value=="function"?n=e.value(a)||[]:n=(h.grammar||[]).filter(s=>s.unit===a)}catch(e){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸Ğº Ñ‡ĞµÑ€ĞµĞ· getter:",e),n=(h.grammar||[]).filter(s=>s.unit===a)}I.value=n;let t=[];try{const e=h.getVocabularyByUnit;e&&typeof e.value=="function"?t=e.value(a)||[]:t=(h.vocabulary||[]).filter(s=>s.tags?.includes(a))}catch(e){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ Ñ‡ĞµÑ€ĞµĞ· getter:",e),t=(h.vocabulary||[]).filter(s=>s.tags?.includes(a))}const f=new Map;for(const e of t){const s=Array.isArray(e?.tags)?e.tags:[];for(const c of s)c&&c!==a&&(/^unit\d+$/i.test(c)||f.set(c,(f.get(c)||0)+1))}const j=Array.from(f.entries()).map(([e,s])=>({tag:e,count:s})).sort((e,s)=>String(e.tag).localeCompare(String(s.tag)));$.value=j;const F=[];for(const e of j){const s=t.filter(p=>Array.isArray(p.tags)&&p.tags.includes(e.tag)),c=Math.ceil(s.length/40);for(let p=0;p<c;p++)F.push({tag:e.tag,batchIndex:p,batchCount:c,wordsCount:s.length,start:p*40,end:Math.min((p+1)*40,s.length)})}P.value=F;let M=[];try{const e=h.getTextsByUnit;e&&typeof e.value=="function"?M=e.value(a)||[]:M=(h.texts||[]).filter(s=>s.unit===a)}catch(e){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· getter:",e),M=(h.texts||[]).filter(s=>s.unit===a)}C.value=M,R.value={name:`Ğ®Ğ½Ğ¸Ñ‚ ${String(a).replace("unit","")}`};const N=await x.getSprintHistoryByUnit(a),L={};for(const e of I.value){const s=N.filter(l=>l.exerciseResults&&l.exerciseResults.some(u=>u.snapshot&&u.snapshot.grammarId===e.id)),c=new Map;for(const l of s){const k=`${(l.exerciseResults||[]).map(m=>{const y=m.snapshot||{};return Array.isArray(y.itemIds)&&y.itemIds.length>0?y.itemIds.join(","):y.itemId!==void 0&&y.itemId!==null?String(y.itemId):m.itemId!==void 0&&m.itemId!==null?String(m.itemId):String(m.exerciseId||"")}).filter(Boolean).sort().join("|")}::${e.id}`;c.has(k)||c.set(k,[]),c.get(k).push(l)}const p=Array.from(c.values()),w=p.length,g=p.map(l=>Math.max(...l.map(u=>u.stats&&typeof u.stats.accuracy=="number"?u.stats.accuracy:0))),V=g.length>0?Math.round(g.reduce((l,u)=>l+u,0)/g.length):null;L[e.id]={timesPracticed:w,lastAccuracy:V}}U.value=L;const O={};for(const e of $.value){const s=N.filter(w=>w.exerciseResults&&w.exerciseResults.some(g=>g.snapshot&&g.snapshot.vocabTag===e.tag)),c=s.length,p=s.length>0&&s[s.length-1]?.stats?s[s.length-1].stats.accuracy:null;O[e.tag]={timesPracticed:c,lastAccuracy:p}}A.value=O;const Q={};for(const e of C.value){const s=N.filter(l=>l.exerciseResults&&l.exerciseResults.some(u=>u.snapshot&&u.snapshot.textId===e.id)),c=new Map;for(const l of s){const k=`${(l.exerciseResults||[]).map(m=>{const y=m.snapshot||{};return y.textQuestionId?String(y.textQuestionId):m.exerciseId?String(m.exerciseId):""}).filter(Boolean).sort().join("|")}::${e.id}`;c.has(k)||c.set(k,[]),c.get(k).push(l)}const p=Array.from(c.values()),w=p.length,g=p.map(l=>Math.max(...l.map(u=>u.stats&&typeof u.stats.accuracy=="number"?u.stats.accuracy:0))),V=g.length>0?Math.round(g.reduce((l,u)=>l+u,0)/g.length):null;Q[e.id]={timesPracticed:w,lastAccuracy:V}}B.value=Q}catch(a){console.error("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚Ğ¾Ğ² ÑĞ½Ğ¸Ñ‚Ğ°:",a)}finally{T.value=!1}});const E=async a=>{await x.setCurrentUnit(S.value);try{await b.push({name:"Sprint",query:{grammarId:a}})}catch(n){console.error("[UnitSprints] Navigation error:",n)}},H=async a=>{try{await x.setCurrentUnit(S.value),await b.push({name:"Sprint",query:{grammarId:a,viewOnly:!0}})}catch(n){console.error("[UnitSprints] Navigation error on viewGrammar:",n)}},z=async a=>{await x.setCurrentUnit(S.value);try{await b.push({name:"Sprint",query:{textId:a}})}catch(n){console.error("[UnitSprints] Navigation error (startTextSprint):",n)}},J=async(a,n)=>{await x.setCurrentUnit(S.value);try{await b.push({name:"Sprint",query:{vocabTag:a,batch:n}})}catch(t){console.error("[UnitSprints] Navigation error (startVocabSprintBatch):",t)}},K=async a=>{try{await x.setCurrentUnit(S.value),await b.push({name:"Sprint",query:{textId:a,viewOnly:!0}})}catch(n){console.error("[UnitSprints] Navigation error on viewText:",n)}};return(a,n)=>(i(),o("div",nt,[r("header",rt,[r("h2",null,"ğŸ“š Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚Ñ‹ â€” "+d(S.value),1),R.value?(i(),o("p",ot,d(R.value.name),1)):v("",!0)]),T.value?(i(),o("div",it,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...")):I.value.length===0&&$.value.length===0&&C.value.length===0?(i(),o("div",ct,"ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞ½Ğ¸Ñ‚Ğ°")):(i(),o("div",lt,[I.value.length>0?(i(),o("div",ut,[(i(!0),o(G,null,q(I.value,t=>(i(),o("div",{key:t.id,class:"grammar-card"},[r("div",dt,[r("h3",pt,d(t.title),1),r("div",vt,[U.value[t.id]?(i(),o("span",ht,"â±ï¸ "+d(U.value[t.id].timesPracticed)+"Ã—",1)):v("",!0),U.value[t.id]?(i(),o("span",gt,"ğŸ“Š "+d(U.value[t.id].lastAccuracy||"â€”")+"%",1)):v("",!0)])]),t.excerpt?(i(),o("p",mt,d(t.excerpt),1)):v("",!0),r("div",yt,[r("button",{onClick:f=>E(t.id),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,_t),r("button",{onClick:f=>H(t.id),class:"btn-view"},"ğŸ‘€ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€",8,ft)])]))),128))])):v("",!0),P.value.length>0?(i(),o("div",xt,[n[0]||(n[0]=r("h3",{class:"section-title"},"ğŸ—£ï¸ Ğ¡Ğ»Ğ¾Ğ²Ğ°",-1)),r("div",St,[(i(!0),o(G,null,q(P.value,t=>(i(),o("div",{key:t.tag+"-"+t.batchIndex,class:"grammar-card"},[r("div",kt,[r("h3",wt,[at(d(t.tag)+" ",1),t.batchCount>1?(i(),o("span",bt," (ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚ "+d(t.batchIndex+1)+" Ğ¸Ğ· "+d(t.batchCount)+")",1)):v("",!0)]),r("div",It,[r("span",null,"ğŸ“¦ "+d(t.wordsCount),1),A.value[t.tag]?(i(),o("span",Ct,"â±ï¸ "+d(A.value[t.tag].timesPracticed)+"Ã—",1)):v("",!0),A.value[t.tag]?(i(),o("span",Ut,"ğŸ“Š "+d(A.value[t.tag].lastAccuracy||"â€”")+"%",1)):v("",!0)])]),r("div",At,[r("button",{onClick:f=>J(t.tag,t.batchIndex),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,Bt)])]))),128))])])):v("",!0),C.value.length>0?(i(),o("div",Mt,[n[1]||(n[1]=r("h3",{class:"section-title"},"ğŸ“ Ğ¢ĞµĞºÑÑ‚Ñ‹",-1)),r("div",Tt,[(i(!0),o(G,null,q(C.value,t=>(i(),o("div",{key:t.id,class:"grammar-card"},[r("div",$t,[r("h3",Rt,d(t.title||"Ğ¢ĞµĞºÑÑ‚ "+t.id),1),r("div",Pt,[B.value[t.id]?(i(),o("span",Nt,"â±ï¸ "+d(B.value[t.id].timesPracticed)+"Ã—",1)):v("",!0),B.value[t.id]?(i(),o("span",Vt,"ğŸ“Š "+d(B.value[t.id].lastAccuracy||"â€”")+"%",1)):v("",!0)])]),t.text?(i(),o("p",Gt,d((t.text||"").slice(0,140))+d((t.text||"").length>140?"â€¦":""),1)):v("",!0),r("div",qt,[r("button",{onClick:f=>z(t.id),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,jt),r("button",{onClick:f=>K(t.id),class:"btn-view"},"ğŸ‘€ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€",8,Ft)])]))),128))])])):v("",!0)]))]))}},Et=W(Lt,[["__scopeId","data-v-1290794b"]]);export{Et as default};
