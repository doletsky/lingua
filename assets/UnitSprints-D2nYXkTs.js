import{_ as z,u as J,a as K,c as W,b as X,r as _,o as Y,d as i,e as r,f as v,t as d,F as N,g as V,h as Z,i as o}from"./index-CycbXK2j.js";const tt={class:"unit-sprints"},et={class:"unit-header"},st={key:0},at={key:0,class:"loading"},nt={key:1,class:"empty"},rt={key:2},it={key:0,class:"sprints-grid"},ot={class:"card-header"},ct={class:"grammar-title"},lt={class:"meta"},ut={key:0},dt={key:1},vt={key:0,class:"grammar-desc"},pt={class:"card-actions"},ht=["onClick"],gt=["onClick"],mt={key:1,class:"texts-section"},yt={class:"sprints-grid"},_t={class:"card-header"},ft={class:"grammar-title"},xt={class:"meta"},St={key:0},kt={key:1},bt={class:"card-actions"},wt=["onClick"],Ut={key:2,class:"texts-section"},It={class:"sprints-grid"},Ct={class:"card-header"},At={class:"grammar-title"},Bt={class:"meta"},Mt={key:0},$t={key:1},Rt={key:0,class:"grammar-desc"},Tt={class:"card-actions"},Pt=["onClick"],Gt=["onClick"],Nt={__name:"UnitSprints",setup(Vt){const L=X(),w=Z(),p=J(),f=K(),x=W(()=>{const s=L.params.unitId;if(s&&typeof s=="string")return s;const n=f.currentUnit;return typeof n=="string"?n:n&&n.value?n.value:String(n)}),R=_(!0),U=_([]),I=_([]),C=_([]),T=_(null),A=_({}),B=_({}),M=_({});Y(async()=>{R.value=!0;try{await p.loadAll();const s=x.value;let n=[];try{const e=p.getGrammarByUnit;e&&typeof e.value=="function"?n=e.value(s)||[]:n=(p.grammar||[]).filter(a=>a.unit===s)}catch(e){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸Ğº Ñ‡ĞµÑ€ĞµĞ· getter:",e),n=(p.grammar||[]).filter(a=>a.unit===s)}U.value=n;let t=[];try{const e=p.getVocabularyByUnit;e&&typeof e.value=="function"?t=e.value(s)||[]:t=(p.vocabulary||[]).filter(a=>a.tags?.includes(s))}catch(e){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ Ñ‡ĞµÑ€ĞµĞ· getter:",e),t=(p.vocabulary||[]).filter(a=>a.tags?.includes(s))}const y=new Map;for(const e of t){const a=Array.isArray(e?.tags)?e.tags:[];for(const u of a)u&&u!==s&&(/^unit\d+$/i.test(u)||y.set(u,(y.get(u)||0)+1))}I.value=Array.from(y.entries()).map(([e,a])=>({tag:e,count:a})).sort((e,a)=>String(e.tag).localeCompare(String(a.tag)));let $=[];try{const e=p.getTextsByUnit;e&&typeof e.value=="function"?$=e.value(s)||[]:$=(p.texts||[]).filter(a=>a.unit===s)}catch(e){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· getter:",e),$=(p.texts||[]).filter(a=>a.unit===s)}C.value=$,T.value={name:`Ğ®Ğ½Ğ¸Ñ‚ ${String(s).replace("unit","")}`};const P=await f.getSprintHistoryByUnit(s),q={};for(const e of U.value){const a=P.filter(c=>c.exerciseResults&&c.exerciseResults.some(l=>l.snapshot&&l.snapshot.grammarId===e.id)),u=new Map;for(const c of a){const k=`${(c.exerciseResults||[]).map(g=>{const m=g.snapshot||{};return Array.isArray(m.itemIds)&&m.itemIds.length>0?m.itemIds.join(","):m.itemId!==void 0&&m.itemId!==null?String(m.itemId):g.itemId!==void 0&&g.itemId!==null?String(g.itemId):String(g.exerciseId||"")}).filter(Boolean).sort().join("|")}::${e.id}`;u.has(k)||u.set(k,[]),u.get(k).push(c)}const S=Array.from(u.values()),b=S.length,h=S.map(c=>Math.max(...c.map(l=>l.stats&&typeof l.stats.accuracy=="number"?l.stats.accuracy:0))),G=h.length>0?Math.round(h.reduce((c,l)=>c+l,0)/h.length):null;q[e.id]={timesPracticed:b,lastAccuracy:G}}A.value=q;const j={};for(const e of I.value){const a=P.filter(b=>b.exerciseResults&&b.exerciseResults.some(h=>h.snapshot&&h.snapshot.vocabTag===e.tag)),u=a.length,S=a.length>0&&a[a.length-1]?.stats?a[a.length-1].stats.accuracy:null;j[e.tag]={timesPracticed:u,lastAccuracy:S}}B.value=j;const F={};for(const e of C.value){const a=P.filter(c=>c.exerciseResults&&c.exerciseResults.some(l=>l.snapshot&&l.snapshot.textId===e.id)),u=new Map;for(const c of a){const k=`${(c.exerciseResults||[]).map(g=>{const m=g.snapshot||{};return m.textQuestionId?String(m.textQuestionId):g.exerciseId?String(g.exerciseId):""}).filter(Boolean).sort().join("|")}::${e.id}`;u.has(k)||u.set(k,[]),u.get(k).push(c)}const S=Array.from(u.values()),b=S.length,h=S.map(c=>Math.max(...c.map(l=>l.stats&&typeof l.stats.accuracy=="number"?l.stats.accuracy:0))),G=h.length>0?Math.round(h.reduce((c,l)=>c+l,0)/h.length):null;F[e.id]={timesPracticed:b,lastAccuracy:G}}M.value=F}catch(s){console.error("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚Ğ¾Ğ² ÑĞ½Ğ¸Ñ‚Ğ°:",s)}finally{R.value=!1}});const O=async s=>{await f.setCurrentUnit(x.value);try{await w.push({name:"Sprint",query:{grammarId:s}})}catch(n){console.error("[UnitSprints] Navigation error:",n)}},Q=async s=>{try{await f.setCurrentUnit(x.value),await w.push({name:"Sprint",query:{grammarId:s,viewOnly:!0}})}catch(n){console.error("[UnitSprints] Navigation error on viewGrammar:",n)}},D=async s=>{await f.setCurrentUnit(x.value);try{await w.push({name:"Sprint",query:{textId:s}})}catch(n){console.error("[UnitSprints] Navigation error (startTextSprint):",n)}},E=async s=>{await f.setCurrentUnit(x.value);try{await w.push({name:"Sprint",query:{vocabTag:s}})}catch(n){console.error("[UnitSprints] Navigation error (startVocabSprint):",n)}},H=async s=>{try{await f.setCurrentUnit(x.value),await w.push({name:"Sprint",query:{textId:s,viewOnly:!0}})}catch(n){console.error("[UnitSprints] Navigation error on viewText:",n)}};return(s,n)=>(o(),i("div",tt,[r("header",et,[r("h2",null,"ğŸ“š Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚Ñ‹ â€” "+d(x.value),1),T.value?(o(),i("p",st,d(T.value.name),1)):v("",!0)]),R.value?(o(),i("div",at,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...")):U.value.length===0&&I.value.length===0&&C.value.length===0?(o(),i("div",nt,"ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞ½Ğ¸Ñ‚Ğ°")):(o(),i("div",rt,[U.value.length>0?(o(),i("div",it,[(o(!0),i(N,null,V(U.value,t=>(o(),i("div",{key:t.id,class:"grammar-card"},[r("div",ot,[r("h3",ct,d(t.title),1),r("div",lt,[A.value[t.id]?(o(),i("span",ut,"â±ï¸ "+d(A.value[t.id].timesPracticed)+"Ã—",1)):v("",!0),A.value[t.id]?(o(),i("span",dt,"ğŸ“Š "+d(A.value[t.id].lastAccuracy||"â€”")+"%",1)):v("",!0)])]),t.excerpt?(o(),i("p",vt,d(t.excerpt),1)):v("",!0),r("div",pt,[r("button",{onClick:y=>O(t.id),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,ht),r("button",{onClick:y=>Q(t.id),class:"btn-view"},"ğŸ‘€ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€",8,gt)])]))),128))])):v("",!0),I.value.length>0?(o(),i("div",mt,[n[0]||(n[0]=r("h3",{class:"section-title"},"ğŸ—£ï¸ Ğ¡Ğ»Ğ¾Ğ²Ğ°",-1)),r("div",yt,[(o(!0),i(N,null,V(I.value,t=>(o(),i("div",{key:t.tag,class:"grammar-card"},[r("div",_t,[r("h3",ft,d(t.tag),1),r("div",xt,[r("span",null,"ğŸ“¦ "+d(t.count),1),B.value[t.tag]?(o(),i("span",St,"â±ï¸ "+d(B.value[t.tag].timesPracticed)+"Ã—",1)):v("",!0),B.value[t.tag]?(o(),i("span",kt,"ğŸ“Š "+d(B.value[t.tag].lastAccuracy||"â€”")+"%",1)):v("",!0)])]),r("div",bt,[r("button",{onClick:y=>E(t.tag),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,wt)])]))),128))])])):v("",!0),C.value.length>0?(o(),i("div",Ut,[n[1]||(n[1]=r("h3",{class:"section-title"},"ğŸ“ Ğ¢ĞµĞºÑÑ‚Ñ‹",-1)),r("div",It,[(o(!0),i(N,null,V(C.value,t=>(o(),i("div",{key:t.id,class:"grammar-card"},[r("div",Ct,[r("h3",At,d(t.title||"Ğ¢ĞµĞºÑÑ‚ "+t.id),1),r("div",Bt,[M.value[t.id]?(o(),i("span",Mt,"â±ï¸ "+d(M.value[t.id].timesPracticed)+"Ã—",1)):v("",!0),M.value[t.id]?(o(),i("span",$t,"ğŸ“Š "+d(M.value[t.id].lastAccuracy||"â€”")+"%",1)):v("",!0)])]),t.text?(o(),i("p",Rt,d((t.text||"").slice(0,140))+d((t.text||"").length>140?"â€¦":""),1)):v("",!0),r("div",Tt,[r("button",{onClick:y=>D(t.id),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,Pt),r("button",{onClick:y=>H(t.id),class:"btn-view"},"ğŸ‘€ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€",8,Gt)])]))),128))])])):v("",!0)]))]))}},Ft=z(Nt,[["__scopeId","data-v-c3050b94"]]);export{Ft as default};
