import{_ as O,u as Q,a as V,c as D,b as E,r as S,o as H,d as i,e as c,f as v,t as u,F as P,g as N,h as z,i as o}from"./index-Bc9j0GCN.js";const J={class:"unit-sprints"},K={class:"unit-header"},W={key:0},X={key:0,class:"loading"},Y={key:1,class:"empty"},Z={key:2},tt={key:0,class:"sprints-grid"},et={class:"card-header"},st={class:"grammar-title"},at={class:"meta"},nt={key:0},rt={key:1},it={key:0,class:"grammar-desc"},ot={class:"card-actions"},ct=["onClick"],lt=["onClick"],ut={key:1,class:"texts-section"},dt={class:"sprints-grid"},pt={class:"card-header"},mt={class:"grammar-title"},vt={class:"meta"},ht={key:0},_t={key:1},yt={key:0,class:"grammar-desc"},gt={class:"card-actions"},ft=["onClick"],xt=["onClick"],St={__name:"UnitSprints",setup(kt){const T=E(),C=z(),h=Q(),g=V(),f=D(()=>{const e=T.params.unitId;if(e&&typeof e=="string")return e;const s=g.currentUnit;return typeof s=="string"?s:s&&s.value?s.value:String(s)}),B=S(!0),k=S([]),w=S([]),M=S(null),I=S({}),U=S({});H(async()=>{B.value=!0;try{await h.loadAll();const e=f.value;let s=[];try{const a=h.getGrammarByUnit;a&&typeof a.value=="function"?s=a.value(e)||[]:s=(h.grammar||[]).filter(l=>l.unit===e)}catch(a){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸Ğº Ñ‡ĞµÑ€ĞµĞ· getter:",a),s=(h.grammar||[]).filter(l=>l.unit===e)}k.value=s;let t=[];try{const a=h.getTextsByUnit;a&&typeof a.value=="function"?t=a.value(e)||[]:t=(h.texts||[]).filter(l=>l.unit===e)}catch(a){console.warn("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· getter:",a),t=(h.texts||[]).filter(l=>l.unit===e)}w.value=t,M.value={name:`Ğ®Ğ½Ğ¸Ñ‚ ${String(e).replace("unit","")}`};const x=await g.getSprintHistoryByUnit(e),R={};for(const a of k.value){const l=x.filter(n=>n.exerciseResults&&n.exerciseResults.some(r=>r.snapshot&&r.snapshot.grammarId===a.id)),d=new Map;for(const n of l){const y=`${(n.exerciseResults||[]).map(p=>{const m=p.snapshot||{};return Array.isArray(m.itemIds)&&m.itemIds.length>0?m.itemIds.join(","):m.itemId!==void 0&&m.itemId!==null?String(m.itemId):p.itemId!==void 0&&p.itemId!==null?String(p.itemId):String(p.exerciseId||"")}).filter(Boolean).sort().join("|")}::${a.id}`;d.has(y)||d.set(y,[]),d.get(y).push(n)}const b=Array.from(d.values()),A=b.length,_=b.map(n=>Math.max(...n.map(r=>r.stats&&typeof r.stats.accuracy=="number"?r.stats.accuracy:0))),$=_.length>0?Math.round(_.reduce((n,r)=>n+r,0)/_.length):null;R[a.id]={timesPracticed:A,lastAccuracy:$}}I.value=R;const G={};for(const a of w.value){const l=x.filter(n=>n.exerciseResults&&n.exerciseResults.some(r=>r.snapshot&&r.snapshot.textId===a.id)),d=new Map;for(const n of l){const y=`${(n.exerciseResults||[]).map(p=>{const m=p.snapshot||{};return m.textQuestionId?String(m.textQuestionId):p.exerciseId?String(p.exerciseId):""}).filter(Boolean).sort().join("|")}::${a.id}`;d.has(y)||d.set(y,[]),d.get(y).push(n)}const b=Array.from(d.values()),A=b.length,_=b.map(n=>Math.max(...n.map(r=>r.stats&&typeof r.stats.accuracy=="number"?r.stats.accuracy:0))),$=_.length>0?Math.round(_.reduce((n,r)=>n+r,0)/_.length):null;G[a.id]={timesPracticed:A,lastAccuracy:$}}U.value=G}catch(e){console.error("[UnitSprints] ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚Ğ¾Ğ² ÑĞ½Ğ¸Ñ‚Ğ°:",e)}finally{B.value=!1}});const q=async e=>{await g.setCurrentUnit(f.value);try{await C.push({name:"Sprint",query:{grammarId:e}})}catch(s){console.error("[UnitSprints] Navigation error:",s)}},j=async e=>{try{await g.setCurrentUnit(f.value),await C.push({name:"Sprint",query:{grammarId:e,viewOnly:!0}})}catch(s){console.error("[UnitSprints] Navigation error on viewGrammar:",s)}},F=async e=>{await g.setCurrentUnit(f.value);try{await C.push({name:"Sprint",query:{textId:e}})}catch(s){console.error("[UnitSprints] Navigation error (startTextSprint):",s)}},L=async e=>{try{await g.setCurrentUnit(f.value),await C.push({name:"Sprint",query:{textId:e,viewOnly:!0}})}catch(s){console.error("[UnitSprints] Navigation error on viewText:",s)}};return(e,s)=>(o(),i("div",J,[c("header",K,[c("h2",null,"ğŸ“š Ğ¡Ğ¿Ñ€Ğ¸Ğ½Ñ‚Ñ‹ â€” "+u(f.value),1),M.value?(o(),i("p",W,u(M.value.name),1)):v("",!0)]),B.value?(o(),i("div",X,"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...")):k.value.length===0&&w.value.length===0?(o(),i("div",Y,"ĞœĞ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹ Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ ÑĞ½Ğ¸Ñ‚Ğ°")):(o(),i("div",Z,[k.value.length>0?(o(),i("div",tt,[(o(!0),i(P,null,N(k.value,t=>(o(),i("div",{key:t.id,class:"grammar-card"},[c("div",et,[c("h3",st,u(t.title),1),c("div",at,[I.value[t.id]?(o(),i("span",nt,"â±ï¸ "+u(I.value[t.id].timesPracticed)+"Ã—",1)):v("",!0),I.value[t.id]?(o(),i("span",rt,"ğŸ“Š "+u(I.value[t.id].lastAccuracy||"â€”")+"%",1)):v("",!0)])]),t.excerpt?(o(),i("p",it,u(t.excerpt),1)):v("",!0),c("div",ot,[c("button",{onClick:x=>q(t.id),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,ct),c("button",{onClick:x=>j(t.id),class:"btn-view"},"ğŸ‘€ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€",8,lt)])]))),128))])):v("",!0),w.value.length>0?(o(),i("div",ut,[s[0]||(s[0]=c("h3",{class:"section-title"},"ğŸ“ Ğ¢ĞµĞºÑÑ‚Ñ‹",-1)),c("div",dt,[(o(!0),i(P,null,N(w.value,t=>(o(),i("div",{key:t.id,class:"grammar-card"},[c("div",pt,[c("h3",mt,u(t.title||"Ğ¢ĞµĞºÑÑ‚ "+t.id),1),c("div",vt,[U.value[t.id]?(o(),i("span",ht,"â±ï¸ "+u(U.value[t.id].timesPracticed)+"Ã—",1)):v("",!0),U.value[t.id]?(o(),i("span",_t,"ğŸ“Š "+u(U.value[t.id].lastAccuracy||"â€”")+"%",1)):v("",!0)])]),t.text?(o(),i("p",yt,u((t.text||"").slice(0,140))+u((t.text||"").length>140?"â€¦":""),1)):v("",!0),c("div",gt,[c("button",{onClick:x=>F(t.id),class:"btn-start"},"â–¶ï¸ ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ ÑĞ¿Ñ€Ğ¸Ğ½Ñ‚",8,ft),c("button",{onClick:x=>L(t.id),class:"btn-view"},"ğŸ‘€ ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€",8,xt)])]))),128))])])):v("",!0)]))]))}},Ut=O(St,[["__scopeId","data-v-4682f670"]]);export{Ut as default};
